name: Build & Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Coolify redeployment
        run: |
          RESPONSE=$(curl -s -X GET \
            "https://coolify.sylphx.com/api/v1/applications/gg00c4s4w0okg40g04wo08k0/start" \
            -H "Authorization: Bearer ${{ secrets.COOLIFY_TOKEN }}")
          echo "Coolify response: $RESPONSE"
          echo "$RESPONSE" | grep -q "deployment_uuid" && echo "✅ Deployment queued" || (echo "❌ Failed" && exit 1)
